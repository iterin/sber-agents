# ADR-001: Использование UV для управления зависимостями и виртуальными окружениями

## Статус
Принято

## Дата
2025-10-28

## Контекст

Для разработки Telegram-бота с LLM-ассистентом нам необходимо выбрать инструмент для управления зависимостями Python и виртуальными окружениями. Проект следует принципам KISS, YAGNI и нацелен на быстрый старт и минимализм.

### Рассмотренные альтернативы:

1. **venv + pip** (встроенные инструменты)
   - ✅ Не требуют установки
   - ✅ Стандартные и простые
   - ❌ Медленная установка пакетов
   - ❌ Нет lock-файлов
   - ❌ Нет управления версиями Python

2. **virtualenv**
   - ✅ Больше функций, чем venv
   - ✅ Поддержка Python 2 и 3
   - ❌ Требует отдельной установки
   - ❌ Медленнее современных альтернатив

3. **Poetry**
   - ✅ Комплексное управление зависимостями
   - ✅ Автоматическое разрешение конфликтов
   - ✅ Lock-файлы (poetry.lock)
   - ✅ Встроенная публикация пакетов
   - ❌ Медленнее UV (в 10-100 раз)
   - ❌ Больше "магии" и абстракций
   - ❌ Избыточен для простого проекта

4. **pipenv**
   - ✅ Объединяет pip + virtualenv
   - ✅ Lock-файлы (Pipfile.lock)
   - ❌ Медленнее UV
   - ❌ Проект менее активен

5. **pyenv + pip**
   - ✅ Управление версиями Python
   - ✅ Гибкость
   - ❌ Требует ручной настройки
   - ❌ Нет автоматического управления окружениями

## Решение

Выбираем **UV** в качестве инструмента для управления зависимостями и виртуальными окружениями.

### Обоснование:

1. **Соответствие принципам проекта:**
   - **KISS** - простой интерфейс командной строки (`uv add`, `uv run`, `uv sync`)
   - **Быстрый старт** - мгновенная установка зависимостей (в 10-100 раз быстрее альтернатив)
   - **Минимализм** - один инструмент заменяет pip, venv и pyenv

2. **Технические преимущества:**
   - Написан на Rust - высочайшая производительность
   - Поддержка `pyproject.toml` - современный стандарт Python
   - Автоматическое создание виртуальных окружений
   - Управление версиями Python из коробки
   - Совместимость с `requirements.txt`
   - Lock-файлы для воспроизводимости окружения

3. **Актуальность:**
   - Современный инструмент (активная разработка в 2024-2025)
   - Растущее community и поддержка
   - Рекомендуется для новых проектов

4. **Простота интеграции:**
   - Легко интегрируется с Makefile
   - Минимальная конфигурация
   - Понятная документация

## Последствия

### Положительные:

- ✅ **Скорость разработки**: быстрая установка пакетов экономит время при настройке окружения
- ✅ **Простота использования**: один инструмент для всех операций с зависимостями
- ✅ **Воспроизводимость**: lock-файлы гарантируют одинаковое окружение на всех машинах
- ✅ **Современность**: использование актуальных инструментов и best practices
- ✅ **Управление Python**: возможность указать точную версию Python для проекта

### Отрицательные:

- ⚠️ **Дополнительная установка**: UV нужно установить отдельно (в отличие от venv)
- ⚠️ **Новизна**: инструмент относительно новый, могут быть edge cases
- ⚠️ **Зависимость**: добавление зависимости от внешнего инструмента

### Миграция:

Если в будущем потребуется миграция на другой инструмент:
- `pyproject.toml` совместим с Poetry и другими современными инструментами
- Lock-файл можно легко перегенерировать
- Виртуальное окружение стандартное, работает с любыми инструментами

## Использование

### Базовые команды:

```bash
# Инициализация проекта
uv init

# Добавление зависимостей
uv add aiogram openai python-dotenv

# Запуск скрипта
uv run python src/bot.py

# Синхронизация зависимостей
uv sync
```

### Интеграция с Makefile:

```makefile
.PHONY: install run dev

install:
	uv sync

run:
	uv run python src/bot.py

dev:
	uv run python src/bot.py --reload
```

## Условия для пересмотра решения

Решение следует пересмотреть, если:
- UV прекратит активную разработку
- Появятся критические баги, блокирующие разработку
- Проект вырастет до масштабов, требующих публикации в PyPI (тогда рассмотреть Poetry)
- Появится требование использовать только встроенные инструменты Python

## Ссылки

- [UV GitHub Repository](https://github.com/astral-sh/uv)
- [UV Documentation](https://docs.astral.sh/uv/)
- [Python Packaging Guide](https://packaging.python.org/)

