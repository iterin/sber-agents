# Итерационный план разработки LLM-ассистента (KISS)

## Прогресс проекта

| Итерация | Кратко | Статус | Прогресс | Примечание |
|---|---|---|---|---|
| 1 | Бот отвечает на /ping | ✅ | 100% | Реализовано |
| 2 | Ответы от LLM (базово) | ✅ | 100% | Реализовано |
| 3 | Память диалога (≤20) | ⏳ | 0% | Обрезка истории |
| 4 | Ошибки/тайм-ауты | ⏳ | 0% | Фолбэки |
| 5 | Конфиг через ENV/Make | ⏳ | 0% | Запуск одной командой |
| 6 | Логирование | ⏳ | 0% | Минимум нужного |
| 7 | Команды /start /help /reset | ⏳ | 0% | UX основа |
| 8 | Рейт-лимит на пользователя | ⏳ | 0% | Анти-спам |

— Этот отчет обновляется после каждой итерации: статус (⏳/✅/⛔️), проценты и примечания.

## Итерационный план

### Итерация 1 — Минимальный бот
- [x] Инициализировать Telegram-бота (polling)
- [x] Команда `/ping` отвечает `pong`
- [x] Тест: отправить `/ping` и получить `pong`

### Итерация 2 — Базовый LLM-ответ
 - [x] Подключить LLM-клиент (OpenAI/OpenRouter) с системным промптом
 - [x] Текстовое сообщение → один ответ от модели
 - [x] Тест: отправить фразу, получить осмысленный ответ (моки при отсутствии ключа)

### Итерация 3 — Контекст диалога
- [ ] Память переписки, обрезка до ≤20 последних сообщений
- [ ] Очистка контекста по `/reset`
- [ ] Тест: отправить >20 сообщений и убедиться, что ранние обрезаются

### Итерация 4 — Обработка ошибок
- [ ] Тайм-ауты и повтор запроса (ограниченно)
- [ ] Пользовательские фолбэки при ошибках (вежливые сообщения)
- [ ] Тест: смоделировать тайм-аут/ошибку и проверить фолбэк

### Итерация 5 — Конфигурация и запуск
- [ ] ENV-переменные (токены, модель, тайм-ауты)
- [ ] Makefile/скрипт для локального запуска
- [ ] Тест: запуск через одну команду с разными ENV

### Итерация 6 — Логирование (минимум)
- [ ] Структурные логи: вход, выход, ошибки (уровни)
- [ ] Корреляция по user/chat (id)
- [ ] Тест: проверить записи логов для типовых сценариев

### Итерация 7 — Базовые команды UX
- [ ] `/start` кратко объясняет возможности
- [ ] `/help` показывает команды и подсказки
- [ ] Тест: проверить ответы `/start` и `/help`

### Итерация 8 — Рейт-лимит
- [ ] Лимит сообщений на пользователя за окно времени
- [ ] Вежливое уведомление при превышении
- [ ] Тест: вызвать лимит, получить уведомление


