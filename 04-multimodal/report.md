# Отчет о выполнении модуля 4: Мультимодальные возможности и локальные модели

## Название проекта и краткое описание

**Персональный финансовый советник** - Telegram-бот для учета доходов и расходов с поддержкой мультимодального ввода (текст, изображения, голосовые сообщения). Бот автоматически извлекает финансовые транзакции из сообщений пользователя и ведет учет баланса.

## Вариант задания

**Базовый:** Доработка проекта из `live/` - добавление транскрибации голоса и работа с Ollama

## Реализованные возможности

- ✅ Обработка текстовых сообщений с извлечением транзакций через LLM
- ✅ Обработка изображений чеков через vision-модели
- ✅ Транскрибация голосовых сообщений с последующим извлечением транзакций
- ✅ Ведение учета доходов и расходов в памяти
- ✅ Формирование отчетов о балансе и статистике по категориям
- ✅ Поддержка команд `/start`, `/balance`, `/transactions`
- ✅ Переключение между облачными (OpenRouter) и локальными (Ollama) моделями
- ✅ Structured output через Pydantic модели для валидации данных
- ✅ Асинхронная обработка всех типов сообщений

## Технологический стек

- **Python 3.11+** - основной язык разработки
- **uv** - управление зависимостями и виртуальным окружением
- **aiogram 3.x** - фреймворк для Telegram Bot API (polling)
- **openai** - клиент для работы с LLM через OpenRouter/Ollama (единый интерфейс)
- **pydantic** - валидация данных и structured output для LLM
- **ffmpeg / ffmpeg-python** - конвертация голосовых сообщений (OGG → WAV)
- **Vosk** - локальная транскрибация голосовых сообщений на CPU
- **python-dotenv** - для работы с переменными окружения
- **Make** - автоматизация сборки и запуска

**Используемые модели:**
- **Текст:** llama3.2, gpt-oss-20b (OpenRouter)
- **Изображения:** llama3.2-vision, meta-llama/llama-3.2-11b-vision-instruct (OpenRouter)

## Инструменты AI-driven разработки

- **IDE:** Cursor (с поддержкой AI-ассистентов)
- **LLM модели:** Grok, Claude 3.5 Sonnet, GPT-4
- **AI-помощь:** Исследование подходов к транскрибации, генерация кода, отладка, настройка сервера

## Скриншоты работы

- ![Демонстрация работы бота](screenshots/Screenshot%202025-11-10%20182521.png)

## Облачный сервер

- **Провайдер:** immers.cloud
- **GPU:** Tesla V100 / RTX 4090
- **Модели Ollama:** qwen2.5:7b-instruct, llama3.2:1b, llama3.2-vision
- **Конфигурация:** Ubuntu CUDA BIOS, диск >60GB, тип Local

## Основные вызовы и решения

1. **Настройка локальной транскрибации голоса:**
   - **Вызов:** Выбор оптимального подхода между облачными API и локальными решениями
   - **Решение:** Исследование с помощью AI показало, что Vosk оптимален для простоты интеграции и работы с русским языком. Реализован pipeline: OGG → WAV через ffmpeg → транскрибация через Vosk → извлечение транзакций

2. **Интеграция vision-моделей:**
   - **Вызов:** Обработка изображений произвольной структуры (чеки, скриншоты)
   - **Решение:** Использование VLM (Vision Language Models) с structured output. Единый интерфейс через AsyncOpenAI для разных провайдеров

3. **Настройка Ollama на облачном сервере:**
   - **Вызов:** Корректная настройка GPU, открытие доступа к API через интернет
   - **Решение:** AI-driven настройка сервера с последовательным выполнением шагов: проверка GPU, установка Ollama, скачивание моделей, настройка firewall

4. **Переключение между провайдерами:**
   - **Вызов:** Единый интерфейс для OpenRouter и Ollama
   - **Решение:** Использование AsyncOpenAI с настраиваемым base_url и api_key через переменные окружения

## Что узнал нового

1. **Мультимодальные возможности LLM:** Научился работать с vision-моделями для обработки изображений и извлечения структурированной информации из чеков и скриншотов.

2. **Локальная транскрибация:** Освоил работу с Vosk для offline-транскрибации голосовых сообщений, включая конвертацию аудиоформатов через ffmpeg.

3. **AI-driven DevOps:** Научился использовать AI-ассистентов для настройки облачных серверов, включая установку GPU-драйверов, настройку firewall и развертывание сервисов.

4. **Structured output в практике:** Применил Pydantic модели для валидации ответов LLM, что обеспечивает надежность извлечения финансовых данных.

5. **Архитектурные принципы:** Закрепил принципы KISS и YAGNI в практике - простой монолитный код без излишней абстракции, но с надежной обработкой ошибок.
